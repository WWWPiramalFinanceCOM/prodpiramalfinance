import{getMetadata as p}from"../../scripts/aem.min.js";import{CFApiCall as b}from"../../scripts/scripts.min.js";export const setLocationObj={getExcelData:null,geoInfo:{city:"",state:"",country:"",location:"",locationcode:""}};const O="AIzaSyDx1HwnCLjSSIm_gADqaYAZhSBh7hgcwTQ",L={};export default async function $(t){const e=Array.from(t.children,h=>h.firstElementChild),[o,a,r,n,s,i,l,d]=e,f=d.textContent.trim(),u=(await b(f))?.data;setLocationObj.getExcelData=sessionStorage.getItem("data")?JSON.parse(sessionStorage.getItem("data")):D(u),sessionStorage.getItem("data")||sessionStorage.setItem("data",JSON.stringify(setLocationObj.getExcelData)),i?.querySelector("picture > img")?.setAttribute("alt",l?.textContent?.trim()||"");const c=`
    <div class="address-wrapper">
      <div class="address-title">${o.innerHTML}</div>
      <div class="address-desktop">${a.innerHTML}</div>
      <div class="address-mobile">${r.innerHTML}</div>
      <div class="address-timing">${n.innerHTML}</div>
      <div class="address-info">${s.innerHTML}</div>
      <div class="address-img">${i.innerHTML}</div>
    </div>
  `;t.innerHTML=c,await v(),I()}async function v(){const t=location.href;if(t.split("/").pop().includes("loans-in")){const a=t.split("/").pop().split("-").pop(),n=Object.values(setLocationObj.getExcelData).flat().find(s=>s["Location Code"]==a);n&&(Object.assign(setLocationObj.geoInfo,{state:S(n.State),city:S(n.City),locationcode:n["Location Code"],location:n.Location}),Object.assign(setLocationObj,{lat:n.Latitude,lng:n.Longitude,address:n.Address,pincode:n.Pincode,pagecontent:n["On Page Content"]}))}x();const o=await M();if(o){setLocationObj.distance=A(setLocationObj.lat,setLocationObj.lng,o.lat,o.lng);const a=document.createElement("li"),r=document.querySelector(".address-info ul");setLocationObj.distance<=40?(a.innerText=`${setLocationObj.distance.toFixed()} Km away from your location`,r.appendChild(a)):a.remove()}setLocationObj.storedata=T(setLocationObj.getExcelData[setLocationObj.geoInfo.state])}function M(){return new Promise(t=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{L.lat=e.coords.latitude,L.lng=e.coords.longitude,t(L)},e=>{console.error("Error getting user location:",e),t(null)}):(console.error("Geolocation is not supported by this browser."),t(null))})}function x(){document.querySelector(".address-title h1").innerText=setLocationObj.geoInfo.location,document.querySelector(".address-desktop p").innerText=setLocationObj.address,document.querySelector(".address-mobile p").innerText=setLocationObj.address}function I(){const{city:t,location:e,locationcode:o,state:a}=setLocationObj.geoInfo,r=(y,w=!1)=>{const m=y.toLowerCase().replace(/\s+/g,"-");return w?m.charAt(0).toUpperCase()+m.slice(1):m},n=r(a),s=r(t),i=r(e.replace(/[()/]/g,"").trim()),l=r(a,!0),d=r(t,!0),f=e.charAt(0).toUpperCase()+e.slice(1),u='<span class="breadcrumb-separator"><svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 9.00195L4.29293 5.70902C4.68182 5.32013 4.68182 4.68377 4.29293 4.29488L1 1.00195" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path></svg></span>',c=[`<a href="${p("lang-path")}/branch-locator/${n}">${l}</a>`];s==i?c.push(`<a href="${p("lang-path")}/branch-locator/${n}/${s}">${d}</a>`):s!==i&&(c.push(`<a href="${p("lang-path")}/branch-locator/${n}/${s}">${d}</a>`),c.push(`<a href="${p("lang-path")}/branch-locator/loans-in-${i}-${s}-${n}-${o}">${f}</a>`));const h=c.join(u);document.querySelector("body .breadcrumb nav").insertAdjacentHTML("beforeend",u+h)}function A(t,e,o,a){const n=g(o-t),s=g(a-e),i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(g(t))*Math.cos(g(o))*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}function g(t){return t*(Math.PI/180)}function D(t){return t.reduce((e,o)=>{const a=o.State.charAt(0).toUpperCase()+o.State.slice(1).toLowerCase();return e[a]||(e[a]=[]),e[a].push(o),e},{})}function S(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}function T(t){var e=t.filter(function(o){return o.City.toLowerCase()===setLocationObj.geoInfo.city.toLowerCase()});return e}
