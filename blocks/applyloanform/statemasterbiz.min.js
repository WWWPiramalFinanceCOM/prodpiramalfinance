import{brachDropDownUl as h,branchInput as L,loanProduct as S,stateDropDownUL as C,stateInput as y}from"./loanformdom.min.js";import{statemasterDataMap as r}from"./statemasterDataMapping.min.js";import{clearPLLoanError as F,validatePLLoan as P}from"./validation.min.js";import{statemasterGetStatesApi as b}from"./statemasterapi.min.js";let f=r.get("statemasterGlobal")||{},v={},m=[],E=!1,g=document.createElement("li");g.textContent="No options",g.classList.add("orangepoints");const A=h()?.querySelector(".orangepoints")||g;export function stateMasterProcessGraphqlData(o){return o.filter(t=>!!t.state&&t.state!="#N/A").reduce((t,s)=>{const a={},n={};return n.data=s.data.map(i=>JSON.parse(i)),n.cities=n.data.reduce((i,d)=>(i.includes(d.city)||i.push(d.city),i),[]),a[s.state.trim()]=n,Object.assign(t,a),t},{})}export function stateMasterProcessApiData(o){const e={};return o.forEach(c=>{if(!c.State)return;const t=c.State.trim().toLowerCase().replace(/\b\w/g,a=>a.toUpperCase());e[t]||(e[t]={cities:[],data:[]});const s=c.location.trim();e[t].cities.includes(s)||e[t].cities.push(s),e[t].data.push({city:s,locationID:null,product:c["Product Code"]?c["Product Code"].toLowerCase():null})}),e}function G(o){const e=Object.keys(o).sort();k(e),E||(document.querySelectorAll(".expert").forEach(t=>{t.addEventListener("click",()=>{k(e),h().replaceChildren(A),v={},m=[]})}),y().addEventListener("change",({currentTarget:t})=>{const s=(m.length?m:e).filter(a=>a.toLowerCase()===t.value.toLowerCase())[0];s?(D(s),t.classList.add("place-selected")):(D([]),t.classList.remove("place-selected")),L().value=""}),S().addEventListener("change",({currentTarget:t})=>{z(t.dataset.loanType),F(),P();const s=["pl","las","lamf"].includes(t.dataset.loanType),a=r.get("allowedType"),n=typeof a=="boolean"?a:!1;s&&!n?(b(t.dataset.loanType),r.set("allowedType",!0)):!s&&n&&(b(t.dataset.loanType),r.set("allowedType",!1))}),y().addEventListener("keyup",({currentTarget:t})=>{const s=C(),a=(m.length?m:e).filter(i=>i.toLocaleLowerCase().includes(t.value.trim().toLocaleLowerCase())),n=a.length>0?u(a,"form-state","States"):u(a,"form-state","No options");s.replaceChildren(n)}),y().addEventListener("input",({currentTarget:t})=>{(m.length&&S().value?m:e).map(a=>a.toLocaleLowerCase()).includes(t.value.trim().toLocaleLowerCase())?t.classList.add("place-selected"):t.classList.remove("place-selected")}),E=!0)}function D(o){const e=h(),t=r.get("statemasterGlobal")[o]?.cities||[],s=t.length>0?u(t,"form-branch-city","Cities"):u(t,"form-branch-city","No options");e.replaceChildren(s),r.set("loanCities",t),e.dataset.keyup||(L().addEventListener("keyup",({currentTarget:a})=>{const n=r.get("loanCities"),i=p=>p.toLowerCase().replace(/[^a-z]/g,""),d=n.map(p=>i(p)).includes(i(a.value)),l=serachCities.length>0?u(serachCities,"form-branch-city","Cities"):u(serachCities,"form-branch-city","No options");e.replaceChildren(l)}),e.dataset.keyup=!0),e.dataset.input||(L().addEventListener("input",({currentTarget:a})=>{const n=r.get("loanCities"),i=l=>l.toLowerCase().replace(/[^a-z]/g,"");n.map(l=>i(l)).includes(i(a.value))?a.classList.add("place-selected"):a.classList.remove("place-selected")}),e.dataset.input=!0)}function u(o,e,c){const t=new DocumentFragment,s=document.createElement("li");s.textContent=c,s.classList.add("orangepoints"),t.append(s);for(const a of o){const n=document.createElement("li");n.dataset.getInput=e,n.textContent=a,n.classList.add("subpoints"),t.append(n)}return t}function O(o){return o.cloneNode(!0)}export function workFlowStatemaster(o){r.set("statemasterGlobal",o),f=o,G(o)}function k(o){const e=C(),c=u(o,"form-state","States"),t=O(c);e.replaceChildren(t)}function z(o){const e={},t=["pl","las","lamf"].includes(o)?"pl":o;for(const i in f){const d=f[i].data,l={cities:[]};for(let p=0;p<d.length;p++){const x=l.cities.includes(d[p].city);if(l.cities.length==f[i].cities.length)break;if(x)continue;const w=d[p].product.split(",").map(N=>N.trim());if(w.length==4){l.cities.push(d[p].city);continue}w.includes(t)&&l.cities.push(d[p].city)}l.cities.length&&(e[i]=l)}const s=Object.keys(e).sort(),a=s.length>0?u(s,"form-state","States"):u(s,"form-state","No options");C().replaceChildren(a),v=e,r.set("productStatemaster",e),m=e,r.set("productStates",s)}
